<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Frontend</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="assets/css/style.css">
  
</head>
<body>
  <app-root></app-root>
  
  
   <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="assets/vendors/chart.js/Chart.min.js"></script>
    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="assets/js/dashboard.js"></script>
     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialisation de la carte centr√©e sur Jendouba
        const map = L.map('map').setView([36.5018, 8.7804], 14);

        // Ajout des tuiles OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        // Ic√¥nes personnalis√©es pour chaque type de visite
        function createCustomIcon(type, number) {
            const iconHtml = `
                <div class="custom-marker marker-${type}" style="position: relative;">
                    ${getIconForType(type)}
                    <div class="marker-number">${number}</div>
                </div>
            `;
            
            return L.divIcon({
                html: iconHtml,
                className: 'custom-div-icon',
                iconSize: [50, 50],
                iconAnchor: [25, 25]
            });
        }

        function getIconForType(type) {
            const icons = {
                'urgent': 'üöë',
                'control': 'üíä',
                'vaccination': 'üíâ',
                'consultation': 'üë®‚Äç‚öïÔ∏è'
            };
            return icons[type] || 'üìç';
        }

        // Donn√©es des points de visite
        const visits = [
            {
                id: 1,
                lat: 36.5018,
                lng: 8.7804,
                type: 'urgent',
                title: 'H√¥pital R√©gional de Jendouba',
                patient: 'M. Jean Martin',
                motif: 'Douleurs thoraciques',
                medecin: 'Dr. Sophie Bernard',
                heure: '08:30 - 09:15'
            },
            {
                id: 2,
                lat: 36.5080,
                lng: 8.7850,
                type: 'control',
                title: 'Cit√© Sportive',
                patient: 'Mme. Marie Curie',
                motif: 'Contr√¥le tension art√©rielle',
                medecin: 'Pierre Moreau',
                heure: '09:30 - 10:00'
            },
            {
                id: 3,
                lat: 36.5050,
                lng: 8.7750,
                type: 'vaccination',
                title: 'Souk-el Arba',
                patient: 'M. Robert Durand',
                motif: 'Vaccin grippe saisonni√®re',
                medecin: 'Alice Petit',
                heure: '10:15 - 10:45'
            },
            {
                id: 4,
                lat: 36.5020,
                lng: 8.7900,
                type: 'consultation',
                title: 'Rond-Point AlHamama',
                patient: 'Mme. Claire Dubois',
                motif: 'Suivi diab√®te',
                medecin: 'Dr. Marc Laurent',
                heure: '11:00 - 11:45'
            },
            {
                id: 5,
                lat: 36.4980,
                lng: 8.7830,
                type: 'urgent',
                title: 'Zone R√©sidentielle P17',
                patient: 'M. Paul Lefevre',
                motif: 'Chute accidentelle',
                medecin: 'Dr. Sophie Bernard',
                heure: '13:30 - 14:15'
            }
        ];

        // Ajout des marqueurs sur la carte
        const markers = [];
        const polylinePoints = [];

        visits.forEach(visit => {
            const marker = L.marker([visit.lat, visit.lng], {
                icon: createCustomIcon(visit.type, visit.id)
            }).addTo(map);

            // Popup d'information
            marker.bindPopup(`
                <div style="min-width: 200px;">
                    <h3>${visit.patient}</h3>
                    <p><strong>Lieu:</strong> ${visit.title}</p>
                    <p><strong>Motif:</strong> ${visit.motif}</p>
                    <p><strong>Professionnel:</strong> ${visit.medecin}</p>
                    <p><strong>Horaire:</strong> ${visit.heure}</p>
                </div>
            `);

            markers.push(marker);
            polylinePoints.push([visit.lat, visit.lng]);
        });

        // Ajout de la ligne de parcours
        const polyline = L.polyline(polylinePoints, {
            color: '#667eea',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 10'
        }).addTo(map);

        // Ajustement de la vue pour voir tous les points
        const group = new L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));

        // Interaction entre les cartes et la carte
        document.querySelectorAll('.visit-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                const visitId = this.getAttribute('data-visit');
                const visit = visits.find(v => v.id == visitId);
                if (visit) {
                    // Animation du marqueur correspondant
                    const marker = markers[visitId - 1];
                    marker.openPopup();
                    
                    // Pulse animation
                    const icon = marker.getElement();
                    if (icon) {
                        icon.style.transform = 'scale(1.2)';
                        icon.style.transition = 'transform 0.3s ease';
                    }
                }
            });

            card.addEventListener('mouseleave', function() {
                const visitId = this.getAttribute('data-visit');
                const marker = markers[visitId - 1];
                const icon = marker.getElement();
                if (icon) {
                    icon.style.transform = 'scale(1)';
                }
            });

            card.addEventListener('click', function() {
                const visitId = this.getAttribute('data-visit');
                const visit = visits.find(v => v.id == visitId);
                if (visit) {
                    map.setView([visit.lat, visit.lng], 16);
                    markers[visitId - 1].openPopup();
                }
            });
        });
    </script>
</body>
</html>
